<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>Counting sourcestamps, changes, and faking data</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
<link href="/counting-sourcestamps-changes-and-faking-data.html" rel="canonical" />
  <!-- Feed -->

  <link href="/theme/css/style.css" type="text/css" rel="stylesheet" />

  <!-- Code highlight color scheme -->
      <link href="/theme/css/code_blocks/github.css" rel="stylesheet">


  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->



    <meta name="description" content="As a follow up to my previous post on my digging through our build status, I want to look with a bit more detail, pretend it'd all be...">

    <meta name="author" content="Axel Hecht">

    <meta name="tags" content="build">
    <meta name="tags" content="buildbot">
    <meta name="tags" content="Mozilla">




<!-- Open Graph -->
<meta property="og:site_name" content="Axel Hecht"/>
<meta property="og:title" content="Counting sourcestamps, changes, and faking data"/>
<meta property="og:description" content="As a follow up to my previous post on my digging through our build status, I want to look with a bit more detail, pretend it'd all be..."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="/counting-sourcestamps-changes-and-faking-data.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2010-11-12 08:31:00+00:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="/author/axel-hecht.html">
<meta property="article:section" content="Mozilla"/>
<meta property="article:tag" content="build"/>
<meta property="article:tag" content="buildbot"/>
<meta property="article:tag" content="Mozilla"/>
<meta property="og:image" content="/theme/images/post-bg.jpg">

<!-- Twitter Card -->

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Counting sourcestamps, changes, and faking data",
  "headline": "Counting sourcestamps, changes, and faking data",
  "datePublished": "2010-11-12 08:31:00+00:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Axel Hecht",
    "url": "/author/axel-hecht.html"
  },
  "image": "/theme/images/post-bg.jpg",
  "url": "/counting-sourcestamps-changes-and-faking-data.html",
  "description": "As a follow up to my previous post on my digging through our build status, I want to look with a bit more detail, pretend it'd all be..."
}
</script>
</head>
<!-- TODO : Body class -->
<body class="home-template">

<nav id="menu">
  <a class="close-button">Close</a>
  <div class="nav-wrapper">
    <p class="nav-label">Menu</p>
    <ul>


    </ul>
  </div>
</nav>
    <!-- Progressbar -->
    <div class="progress-container">
        <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="post-header" >
      <div class="inner">
        <nav id="navigation">
            <span id="home-button" class="nav-button">
                <a class="home-button" href="/" title="Home"><i class="ic ic-arrow-left"></i> Home</a>
            </span>
          <span id="menu-button" class="nav-button">
            <a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
          </span>
        </nav>
        <h1 class="post-title">Counting sourcestamps, changes, and faking data</h1>
        <!-- TODO : Proper class for headline -->
        <span class="post-meta">
                <a href="/author/axel-hecht.html">Axel Hecht</a>
            | <time datetime="Fri 12 November 2010">Fri 12 November 2010</time>
        </span>
        <!-- TODO : Modified check -->
      </div>
    </header>

  <section id="wrapper">
    <a class="hidden-close"></a>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
            <section class="post-content">
                <p>As a follow up to my <a class="reference external" href="http://blog.mozilla.org/axel/2010/11/10/looking-at-the-internals-of-our-builds/">previous post</a> on my digging through our build status, I want to look with a bit more detail, pretend it'd all be simple and what it could be, and, well, add the promised chocolate to coconut. Bounty.</p>
<p>Let's look at the actual data for two and half landings. First, I'll start with a rather simple landing by roc, <a class="reference external" href="http://hg.mozilla.org/mozilla-central/pushloghtml?changeset=1b43ce0bda4fae">revision 1b43... on mozilla-central</a>. Let me summarize the <a class="reference external" href="http://l10n.mozilla-community.org/coconut/sources?revision=1b43ce0bda4fae9292f63c253af44f3794d62604&amp;count=200">builds</a> real quick:</p>
<p>1 changeset in 1 push.</p>
<p>27 change rows in status db.</p>
<p>16 different branch names.</p>
<p>106 sourcestamps in status db.</p>
<p>245 builds.</p>
<p>That's a lot, because, what we're really interested in is</p>
<p>1 push, 245 builds.</p>
<p>Talk is cheap, but what's really cheap is manipulating other peoples database, so while Vettel was running in circles in Brazil, I was running circles in the db and manually stitched things back together. The result is still coconut, but with chocolate, so here is the <a class="reference external" href="http://l10n.mozilla-community.org/bounty/sources?revision=1b43ce0bda4fae9292f63c253af44f3794d62604&amp;count=200">same url in bounty</a>.</p>
<p>1 source, 1 change, 253 builds.</p>
<p>Wait, what, not 245? No, 253, because, well, there are more disconnects in the status, so the query in the database doesn't catch them all. That's what you need manual stitching for. Also, finding the right sourcestamp to keep isn't trivial.</p>
<p>Which is why I only did it for a few builds. Sorry, you'll not find a lot of builds that are stitched together, so enjoy the guided tour through the few shiny places.</p>
<p>During my needlework I came across another set of changes which are worthwhile to include into today's tour. It's two pushes, by <a class="reference external" href="http://hg.mozilla.org/mozilla-central/pushloghtml?changeset=3f499de2401d">khuey</a> and <a class="reference external" href="http://hg.mozilla.org/mozilla-central/pushloghtml?changeset=30a1be9d442a">vlad</a>. Let's give Count Count a rest and look at them with chocolate right away, the builds for <a class="reference external" href="http://l10n.mozilla-community.org/bounty/sources?revision=3f499de2401d0e9e02fc644ff574ae103e3a394a">khuey's revision</a> and <a class="reference external" href="http://l10n.mozilla-community.org/bounty/sources?revision=30a1be9d442a98adb4a2095f9c8ee1808dd29560">vlad's</a>. What you'll notice is that some of the builds for khuey aren't there, but lumped together with vlad's. Why's that?</p>
<p>Our build infrastructure really doesn't know about pushes. As I've detailed in my previous post, there are sourcestamps and changes, but no further grouping. At this point it's really a design decision on whether the buildbot changes are hg pushes or hg changesets. This decision is currently in favor of hg changesets, which may just be right. At that point, the scheduling logic that puts changes into builds needs to put extra care into creating sourcestamps for what we intend to get builds for, and to keep those sourcestamps apart. The current implementation puts anything coming in within three minutes into the same sourcestamp, which is <em>somewhat</em> of a load limiter.</p>
<p>Anyway, back to chocolate. When you looked at the pages, did you realize that once you add it, you're almost at a tinderboxpushlog page? Right, it could be that &quot;easy&quot;.</p>
<p>What's between reality and chocolate? Well, <tt class="docutils literal">sendchange</tt>. That's a buildbot architecture component that allows shell commands to insert changes into buildmaster. It's rather limited in the data it can transport, which is why we loose data on the way. There's an alternative feature called <tt class="docutils literal">trigger</tt>, which doesn't. There is an <a class="reference external" href="http://buildbot.net/trac/ticket/1039">open ticket</a> to make that span different buildmasters, but given how much Mozilla invested into schedulerdb, let's pray it's easy to fix. Filed <a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=611670">bug 611670</a>.</p>
<p>Update: Changed links to l10n community server.</p>

            </section>

            <section class="post-info">
                <div class="post-share">
                    <a class="twitter" href="https://twitter.com/share?text=Counting sourcestamps, changes, and faking data&amp;url=/counting-sourcestamps-changes-and-faking-data.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
                    </a>
                    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=/counting-sourcestamps-changes-and-faking-data.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
                    </a>
                    <a class="googleplus" href="https://plus.google.com/share?url=/counting-sourcestamps-changes-and-faking-data.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="ic ic-googleplus"></i><span class="hidden">Google+</span>
                    </a>
                    <div class="clear"></div>
                </div>

                <aside class="post-tags">
<a href="/tag/build.html">build</a><a href="/tag/buildbot.html">buildbot</a><a href="/tag/mozilla.html">Mozilla</a>                </aside>

                <div class="clear"></div>


                </section>


                <aside class="post-nav">
                    <div class="clear"></div>
                </aside>

            </div>
        </article>
    </main>
      <!-- TODO : Body class -->
    <div id="body-class" style="display: none;" class=""></div>

    <footer id="footer">
      <div class="inner">
        <section class="credits">


          <span class="credits-theme">Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a></span>
          <span class="credits-software">Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a></span>
        </section>
      </div>
    </footer>
  </section>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script type="text/javascript" src="/theme/js/script.js"></script>

</body>
</html>