<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>Migrate to Fluent</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
<link href="/2019/05/migrate-to-fluent" rel="canonical" />
  <!-- Feed -->

  <link href="/theme/css/style.css" type="text/css" rel="stylesheet" />

  <!-- Code highlight color scheme -->
      <link href="/theme/css/code_blocks/github.css" rel="stylesheet">


  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->



    <meta name="description" content="Introduction A couple of weeks ago the Localization Team at Mozilla released the Fluent Syntax specification. As mentioned in our...">

    <meta name="author" content="Axel Hecht">

    <meta name="tags" content="Fluent">




<!-- Open Graph -->
<meta property="og:site_name" content="Axel Hecht"/>
<meta property="og:title" content="Migrate to Fluent"/>
<meta property="og:description" content="Introduction A couple of weeks ago the Localization Team at Mozilla released the Fluent Syntax specification. As mentioned in our..."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="/2019/05/migrate-to-fluent"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-05-02 01:24:00+00:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="/author/axel-hecht.html">
<meta property="article:section" content="L10n"/>
<meta property="article:tag" content="Fluent"/>
<meta property="og:image" content="/theme/images/post-bg.jpg">

<!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@axelhecht">
    <meta name="twitter:title" content="Migrate to Fluent">
    <meta name="twitter:url" content="/2019/05/migrate-to-fluent">

        <meta name="twitter:image:src" content="/theme/images/post-bg.jpg">

      <meta name="twitter:description" content="Introduction A couple of weeks ago the Localization Team at Mozilla released the Fluent Syntax specification. As mentioned in our...">

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Migrate to Fluent",
  "headline": "Migrate to Fluent",
  "datePublished": "2019-05-02 01:24:00+00:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Axel Hecht",
    "url": "/author/axel-hecht.html"
  },
  "image": "/theme/images/post-bg.jpg",
  "url": "/2019/05/migrate-to-fluent",
  "description": "Introduction A couple of weeks ago the Localization Team at Mozilla released the Fluent Syntax specification. As mentioned in our..."
}
</script>
</head>
<!-- TODO : Body class -->
<body class="home-template">

<nav id="menu">
  <a class="close-button">Close</a>
  <div class="nav-wrapper">
    <p class="nav-label">Menu</p>
    <ul>

                  <li class="nav-l10n active" role="presentation"><a href="/category/l10n.html">L10n</a></li>
                  <li role="presentation"><a href="/category/misc.html">Misc</a></li>
                  <li role="presentation"><a href="/category/mozilla.html">Mozilla</a></li>
                  <li role="presentation"><a href="/category/rdf.html">RDF</a></li>

    </ul>
  </div>
</nav>
    <!-- Progressbar -->
    <div class="progress-container">
        <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="post-header" >
      <div class="inner">
        <nav id="navigation">
            <span id="home-button" class="nav-button">
                <a class="home-button" href="/" title="Home"><i class="ic ic-arrow-left"></i> Home</a>
            </span>
          <span id="menu-button" class="nav-button">
            <a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
          </span>
        </nav>
        <h1 class="post-title">Migrate to Fluent</h1>
        <!-- TODO : Proper class for headline -->
        <span class="post-meta">
                <a href="/author/axel-hecht.html">Axel Hecht</a>
            | <time datetime="Thu 02 May 2019">Thu 02 May 2019</time>
        </span>
        <!-- TODO : Modified check -->
      </div>
    </header>

  <section id="wrapper">
    <a class="hidden-close"></a>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
            <section class="post-content">
                <div class="section" id="introduction">
<h2>Introduction</h2>
<p>A couple of weeks ago the Localization Team at Mozilla <a class="reference external" href="https://hacks.mozilla.org/2019/04/fluent-1-0-a-localization-system-for-natural-sounding-translations/">released the Fluent Syntax specification</a>. As mentioned in our announcement, we already have over 3000 Fluent strings in Firefox. You might wonder how we introduced Fluent to a running project. In this post I'll detail on how the design of Fluent plays into that effort, and how we pulled it off.</p>
<p><a class="reference external" href="https://arewefluentyet.com"><img alt="image0" class="aligncenter size-full wp-image-603" src="/images/2019/04/arewefluentyet.png" style="width: 600px; height: 367px;" /></a></p>
</div>
<div class="section" id="fluent-s-design-for-simplicity">
<h2>Fluent's Design for Simplicity</h2>
<p>Fluent abstracts away the complexities of human languages from programmers. At the same time, Fluent makes easy things easy for localizers, while making complex things possible.</p>
<p>When you migrate a project to Fluent, you build on both of those design principles. You will simplify your code, and move the string choices from your program into the Fluent files. Only then you'll expose Fluent to localizers to actually take advantage of the capabilities of Fluent, and to perfect the localizations of your project.</p>
</div>
<div class="section" id="fluent-s-layered-design">
<h2>Fluent's Layered Design</h2>
<p>When building runtime implementations, we created several layers to tightly own particular tasks.</p>
<ol class="arabic simple">
<li>Fluent source files are parsed into Resources.</li>
<li>Multiple resources are aggregated in Bundles, which expose APIs to resolve single strings. Message and Term references resolve inside Bundles, but not necessarily inside Resources. A Bundle is associated with a single language, as well as fallback languages for i18n libraries.</li>
<li>Language negotiation and language fallback happen in the Localization level. Here you'd implement that someone looking for Frisian would get a Frisian string. If that's missing or has a runtime problem, you might want to try Dutch, and then English.</li>
<li>Bindings use the Localization API, and integrate it into the development stack. They marshal data models from the programming language into Fluent data models like strings, numbers, and dates. Declarative bindings also apply the localizations to the rendered UI.</li>
</ol>
<div class="section" id="invest-in-bindings">
<h3>Invest in Bindings</h3>
<p>Bindings integrate Fluent into your development workflow. For Firefox, we focused on <a class="reference external" href="https://firefox-source-docs.mozilla.org/intl/l10n/l10n/fluent_tutorial.html#markup-localization">bindings to generate localized DOM</a>. We also have <a class="reference external" href="https://github.com/projectfluent/fluent.js/wiki/React-Bindings">bindings for React</a>. These bindings determine how fluent Fluent feels to developers, but also how much Fluent can help with handling the localized return values. To give an example, integrating Fluent into Android app development would probably focus on a <a class="reference external" href="https://developer.android.com/reference/android/view/LayoutInflater">LayoutInflator</a>. In the bindings we use at Mozilla, we decided to localize as close to the actual display of the strings as possible.</p>
<p>If you have declarative UI generation, you want to look into a declarative binding for Fluent. If your UI is generated programmatically, you want a programmatic binding.</p>
<p>The Localization classes also integrate IO into your application runtime, and making the right choices here has strong impact on performance characteristics. Not just on speed, but also the question of showing untranslated strings shortly.</p>
</div>
</div>
<div class="section" id="migrate-your-code">
<h2>Migrate your Code</h2>
<p>Migrating your code will often be a trivial change from one API to another. Most of your code will get a string and show it, after all. You might convert several different APIs into just one in Fluent, in particular dedicated plural APIs will go away.</p>
<p>You will also move platform-specific terminology into the localization side, removing conditional code. You should also be able to stop stitching several localized strings together in your application logic.</p>
<p>As we'll go through the process here, I'll show an example of a sentence with a link. The project wants to be really sure the link isn't broken, so it's not exposed to localizers at all. This is shortened from an actual example in Firefox, where we link to our privacy policy. We'll convert to <a class="reference external" href="https://github.com/projectfluent/fluent.js/wiki/DOM-Overlays#functional-elements">DOM overlays</a>, to separate localizable and non-localizable aspects of the DOM in Fluent. Let's just look at the HTML code snippet now, and look at the localizations later.</p>
<p>Before:</p>
<pre class="literal-block">
&lt;li&gt;&amp;msg-start;&lt;a href=&quot;https://example.com&quot;&gt;&amp;msg-middle;&lt;/a&gt;&amp;msg-end;&lt;/li&gt;
</pre>
<p>After:</p>
<pre class="literal-block">
&lt;li data-l10n-id=&quot;msg&quot;&gt;&lt;a href=&quot;https://example.com&quot; data-l10n-name=&quot;msg-link&quot;&gt;&lt;/a&gt;&lt;/li&gt;
</pre>
</div>
<div class="section" id="migrate-your-localizations">
<h2>Migrate your Localizations</h2>
<p>Last but not least, we'll want to migrate the localizations. While migrating code is work, losing all your existing localizations is just outright a bad idea.</p>
<p>For our work on Firefox, we use a Python package named <tt class="docutils literal">fluent.migrations</tt>. It's building on top of the <tt class="docutils literal">fluent.syntax</tt> package, and programmatically creates Fluent files from existing localizations.</p>
<p>It allows you to copy and paste existing localizations into a Fluent string for the most simple cases. It also concats several strings into a single result, which you used to do in your code. For these very simple cases, it even uses Fluent syntax, with specialized global functions to copy strings.</p>
<p>Example:</p>
<pre class="literal-block">
msg = {COPY(from_path,&quot;msg-start&quot;)}&lt;a data-l10n-name=&quot;msg-link&quot;&gt;{COPY(from_path,&quot;msg-middle&quot;)}&lt;/a&gt;{COPY(from_path,&quot;msg-end&quot;)}
</pre>
<p>Then there are a bit more complicated tasks, notably involving variable references. Fluent only supports its built-in variable placement, so you need to migrate away from <tt class="docutils literal">printf</tt> and friends. That involves firstly normalizing the various ways that a printf parameter can be formatted and placed, and then the code can do a simple replacement of the text like <tt class="docutils literal">%2$S</tt> with a Fluent variable reference like <tt class="docutils literal"><span class="pre">{user-name}</span></tt>.</p>
<p>We also have logic to read our Mozilla-specific plural logic from legacy files, and to write them out as <a class="reference external" href="https://projectfluent.org/fluent/guide/selectors.html">select-expressions</a> in Fluent, with a variant for each plural form.</p>
<p>These transforms are implemented as pseudo nodes in a template AST, which is then evaluated against the legacy translations and creates an actual AST, which can then be serialized.</p>
<p>Concluding our example, before:</p>
<pre class="literal-block">
&lt;ENTITY msg-start &quot;This is a link to an &quot;&gt;
&lt;ENTITY msg-middle &quot;example&quot;&gt;
&lt;ENTITY msg-end &quot;.&quot;&gt;
</pre>
<p>After:</p>
<pre class="literal-block">
msg = This is a link to an &lt;a data-l10n-name=&quot;msg-link&quot;&gt;example&lt;/a&gt; site.
</pre>
<p>Find out more about this package and its capabilities in the <a class="reference external" href="https://firefox-source-docs.mozilla.org/intl/l10n/l10n/fluent_migrations.html">documentation</a>.</p>
<p>Given that we're OpenSource, we also want to carry over attribution. Thus our code not only migrates all the data, but also splits the migration into individual commits, one for each author of the migrated translations.</p>
<p>Once the baseline is migrated, localizers can dive in and improve. They can then start using parameterized Terms to adjust grammar, for example. Or add a plural form where English didn't need one. Or introduce a platform-specific terminology that only exists in their language.</p>
</div>

            </section>

            <section class="post-info">
                <div class="post-share">
                    <a class="twitter" href="https://twitter.com/share?text=Migrate to Fluent&amp;url=/2019/05/migrate-to-fluent" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
                    </a>
                    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=/2019/05/migrate-to-fluent" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
                    </a>
                    <a class="googleplus" href="https://plus.google.com/share?url=/2019/05/migrate-to-fluent" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="ic ic-googleplus"></i><span class="hidden">Google+</span>
                    </a>
                    <div class="clear"></div>
                </div>

                <aside class="post-tags">
<a href="/tag/fluent.html">Fluent</a>                </aside>

                <div class="clear"></div>


                </section>


                <aside class="post-nav">
                    <div class="clear"></div>
                </aside>

            </div>
        </article>
    </main>
      <!-- TODO : Body class -->
    <div id="body-class" style="display: none;" class=""></div>

    <footer id="footer">
      <div class="inner">
        <section class="credits">


          <span class="credits-theme">Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a></span>
          <span class="credits-software">Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a></span>
        </section>
      </div>
    </footer>
  </section>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script type="text/javascript" src="/theme/js/script.js"></script>

</body>
</html>