<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>Looking at the internals of our builds</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
<link href="/looking-at-the-internals-of-our-builds.html" rel="canonical" />
  <!-- Feed -->

  <link href="/theme/css/style.css" type="text/css" rel="stylesheet" />

  <!-- Code highlight color scheme -->
      <link href="/theme/css/code_blocks/github.css" rel="stylesheet">


  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->



    <meta name="description" content="Chris Atlee has put up database dumps of both the scheduler and the status databases. These databases are the most detailed and (almost,...">

    <meta name="author" content="Axel Hecht">

    <meta name="tags" content="build">
    <meta name="tags" content="buildbot">
    <meta name="tags" content="Mozilla">




<!-- Open Graph -->
<meta property="og:site_name" content="Axel Hecht"/>
<meta property="og:title" content="Looking at the internals of our builds"/>
<meta property="og:description" content="Chris Atlee has put up database dumps of both the scheduler and the status databases. These databases are the most detailed and (almost,..."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="/looking-at-the-internals-of-our-builds.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2010-11-10 09:34:00+00:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="/author/axel-hecht.html">
<meta property="article:section" content="Mozilla"/>
<meta property="article:tag" content="build"/>
<meta property="article:tag" content="buildbot"/>
<meta property="article:tag" content="Mozilla"/>
<meta property="og:image" content="/theme/images/post-bg.jpg">

<!-- Twitter Card -->

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Looking at the internals of our builds",
  "headline": "Looking at the internals of our builds",
  "datePublished": "2010-11-10 09:34:00+00:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Axel Hecht",
    "url": "/author/axel-hecht.html"
  },
  "image": "/theme/images/post-bg.jpg",
  "url": "/looking-at-the-internals-of-our-builds.html",
  "description": "Chris Atlee has put up database dumps of both the scheduler and the status databases. These databases are the most detailed and (almost,..."
}
</script>
</head>
<!-- TODO : Body class -->
<body class="home-template">

<nav id="menu">
  <a class="close-button">Close</a>
  <div class="nav-wrapper">
    <p class="nav-label">Menu</p>
    <ul>


    </ul>
  </div>
</nav>
    <!-- Progressbar -->
    <div class="progress-container">
        <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="post-header" >
      <div class="inner">
        <nav id="navigation">
            <span id="home-button" class="nav-button">
                <a class="home-button" href="/" title="Home"><i class="ic ic-arrow-left"></i> Home</a>
            </span>
          <span id="menu-button" class="nav-button">
            <a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
          </span>
        </nav>
        <h1 class="post-title">Looking at the internals of our builds</h1>
        <!-- TODO : Proper class for headline -->
        <span class="post-meta">
                <a href="/author/axel-hecht.html">Axel Hecht</a>
            | <time datetime="Wed 10 November 2010">Wed 10 November 2010</time>
        </span>
        <!-- TODO : Modified check -->
      </div>
    </header>

  <section id="wrapper">
    <a class="hidden-close"></a>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
            <section class="post-content">
                <p>Chris Atlee has put up database dumps of both the <a class="reference external" href="https://wiki.mozilla.org/ReleaseEngineering/BuildAPI">scheduler and the status databases</a>. These databases are the most detailed and (almost, status db is not) first class information on what our builds are really doing. The current code on top of that is all pylons-based, and I am, as many other mozillians, part of the django shop. So for one I figured &quot;let's see if I can make django read this&quot;.</p>
<p>I can. It's a bit rough, though, as some of the tables for many-to-many relationships don't contain a primary key column. Django really doesn't like that, and thus there are some things that you cannot do without those columns. Most of it works just fine, though. This holds at least for the status db, which I looked at in more detail, but the scheduler db ain't much different. Filed <a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=611014">bug 611014</a>.</p>
<p>The code for this is up at <a class="reference external" href="https://github.com/Pike/django_moz_status">django_moz_status on github</a>.</p>
<p>Of course, me being able to talk to the db with a python shell won't help you much, right? So I've spent a few more hours to actually create a really rough website on top of it, which I want to share with you.</p>
<p>Coconut. Hard to open, and once you get there, you may not like it. I have a thing with project names.</p>
<p><a class="reference external" href="https://github.com/Pike/coconut">Coconut</a> is a bunch of django views on top of django_moz_status, held together by <a class="reference external" href="https://github.com/Pike/site_demo">site_demo</a>. You can see it in action (for now) on the <a class="reference external" href="http://l10n.mozilla-community.org/coconut/sources?count=50&amp;offset=1362437&amp;exclude_empty&amp;branch=mozilla-central">l10n community server</a>. This view is exposing three concepts of buildbot, and how they play together:</p>
<p>Sourcestamps (first column): Every build in buildbot has a sourcestamp, and a sourcestamp can have multiple builds. The sourcestamp knows a branch, a revision, and a list of changes going into the builds associated with it.</p>
<p>Changes (second column): Changes are the external &quot;real life&quot; events that may or may not trigger builds. In this view, you see a few list of changes that look like a push to hg (and are just that), as well as a plethora of changes by Mr. sendchange, and Mr. sendchange-unittest. If you remove some query params on the above URL, you can also see a <a class="reference external" href="http://l10n.mozilla-community.org/coconut/sources?count=50&amp;offset=1362437">bunch of sourcestamps without changes</a>. Those are nightlies.</p>
<p>Builds (last column): Each sourcestamp can have multiple builds, I'm just showing the builder name (a symbolic short name), the buildnumber, and the result as color. The third column is actually a guess on the platform of the build, based on the <tt class="docutils literal">platform</tt> build property. If that's not set, <tt class="docutils literal">unknown</tt> is used.</p>
<p>Which brings me nicely to another two pieces of our build infrastructure that has been hard to look at so far. Build steps and build properties. Surf along? Let's look at <a class="reference external" href="http://l10n.mozilla-community.org/coconut/build/1894077">a build</a>.</p>
<p>The first section of the build pages shows some general information, builder, buildnumber, status. The start and end time, how long the build took. Also it lists the buildbot master, and the category of the builder. Categories allow to filter for builds, sadly, a builder can only be in one category.</p>
<p>Next up is build steps. Each step in a build is an item of work, and an entity of failure. Different steps can handle failures differently, too. You can see that the build starts with a flock of steps that do administrative tasks on the slave. You can see which fragment of time of the build that step took by looking at the bar in the second column. You'll see that the majority of that build went into the compile step. And that that passed. And after that compile, there's a bunch of adminstrative stuff again.</p>
<p>There are two things that you do not see. One is, each of those steps has build logs attached to them. Commonly one, but possibly more. I'll talk more about logs in a different post. The other thing is, steps can change the build properties. Which is to say, the build properties which are shown at the end of the build page are not static, but change during the build run.</p>
<p>Build properties? Right, within buildbot, several objects can have properties, among them, builds. You'll find things like the buildnumber, the slavename, the branch, buildername (pretty). You'll also find a host of things around the packaging of the build. Quite generally, our build try to put things that are needed for the build itself or for logic around into build properties.</p>
<p>The end of the page is reiterating which changes are associated with the sourcestamp for this build.</p>
<p>Let me stress your patience once more and invite you to visit a <a class="reference external" href="http://l10n.mozilla-community.org/coconut/build/1893242">build with a failed step</a>. In this build page you can see how the clobber step worked fine, and took quite some time, and the actual status of the build is due to the actual test step failing with a warning.</p>
<p>Now this post is already pretty lengthy, so I'll take a break here and invite you to go in and click back and forth a bit, and to do some url hacking. If you think this is rough and you're having a hard time figuring out what's why, I'll do a follow up post on how to add chocolate to coconut.</p>
<p>PS: the database this instance is working on is a snapshot that ends in August, details may be different today. I shrunk the database, too, only the last 10k builds still have the buildsteps.</p>
<p>Update: Changed the links to the l10n community server.</p>

            </section>

            <section class="post-info">
                <div class="post-share">
                    <a class="twitter" href="https://twitter.com/share?text=Looking at the internals of our builds&amp;url=/looking-at-the-internals-of-our-builds.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
                    </a>
                    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=/looking-at-the-internals-of-our-builds.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
                    </a>
                    <a class="googleplus" href="https://plus.google.com/share?url=/looking-at-the-internals-of-our-builds.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="ic ic-googleplus"></i><span class="hidden">Google+</span>
                    </a>
                    <div class="clear"></div>
                </div>

                <aside class="post-tags">
<a href="/tag/build.html">build</a><a href="/tag/buildbot.html">buildbot</a><a href="/tag/mozilla.html">Mozilla</a>                </aside>

                <div class="clear"></div>


                </section>


                <aside class="post-nav">
                    <div class="clear"></div>
                </aside>

            </div>
        </article>
    </main>
      <!-- TODO : Body class -->
    <div id="body-class" style="display: none;" class=""></div>

    <footer id="footer">
      <div class="inner">
        <section class="credits">


          <span class="credits-theme">Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a></span>
          <span class="credits-software">Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a></span>
        </section>
      </div>
    </footer>
  </section>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script type="text/javascript" src="/theme/js/script.js"></script>

</body>
</html>